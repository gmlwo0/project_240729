<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/defaultLayout}">
<section layout:fragment="content"
	class="contents d-flex justify-content-center">
	<div class="w-50">
		<h1>영화 리뷰 작성</h1>
		<div class="d-flex">
			<input type="text" id="userId" class="form-control" placeholder="작성자">
			<input type="text" id="point" class="form-control col-5"
				placeholder="별점/5">
		</div>
		<input type="text" id=movieId class="form-control" placeholder="제목">
		<textarea rows="10" id="content" class="form-control" placeholder="내용"></textarea>

		<!-- 댓글 제목 -->
		<div class="card-comment-title border-bottom">
			<div class="font-weight-bold ml-3 mb-1">댓글</div>
		</div>

		<!-- 댓글 목록 -->
		<div class="card-comment-list m-2">
			댓글들
		
 			<div class="card-comment m-1"
				th:each="comment : ${commentView.commentList}">
				<span class="font-weight-bold" th:text="${commentView.user.loginId}">댓글쓰니</span>
				<span th:text="${commentView.comment.content}">댓글 내용임</span>
 
				댓글 삭제(자신의 댓글만 가능)
				<a href="#" class="comment-del-btn"
					th:if="${session.userId == commentView.comment.userId}"
					th:data-comment-id="${commentView.comment.id}"></a>
			</div>

			댓글 쓰기
			<div class="comment-write d-flex border-top mt-2">
				<input type="text" class="comment-input form-control border-0 mr-2"
					placeholder="댓글 달기">
				<button type="button" class="comment-btn btn btn-light"
					th:data-post-id="${commentView.post.id}"
					th:data-user-id="${session.userId}">게시</button>
			</div>
		</div>	 -->
		<!-- 댓글 끝 -->
		<div class="d-flex justify-content-between">
			<button type="button" id="ListBtn" class="mt-3 btn btn-dark">목록</button>

			<div>
				<button type="button" id="clearBtn" class="mt-3 btn btn-secondary">삭제</button>
				<button type="button" id="renameBtn" class="mt-3 btn btn-info">수정</button>
				<button type="button" id="saveBtn" class="mt-3 btn btn-warning">저장</button>
			</div>
		</div>
	</div>
</section>

<th:block layout:fragment="script">
	<script>
		$(document).ready(function(){
	    	$("#ListBtn").on('click',function(){
	    		location.href="/post/post-list-view"
	    	});
			$("#saveBtn").on('click',function(){
				let postId = $(this).data("post-id");
				let userId = $("#userId").val().trim();
				let movieId = $("#subject").val().trim();
				let point = $("#point").val().trim();
				let content = $("#content").val();
				
		   		if (!userId) {
	    			alert("작성자를 입력해주세요");
	    			return;
	    		}
	    		if (!point){
	    			alert("별점을 입력해주세요");
	    			return;
	    		}
	    		if (!movieId) {
	    			alert("제목을 입력해주세요");
	    			return;
	    		}
	    		if (!content) {
	    			alert("내용을 입력해주세요");
	    			return;
	    		}
	    		
				console.log(userId);
				console.log(movieId);
				console.log(content);
				console.log(point);
				
				$.ajax({
					type:"put"
					, url:"/post/update"
					,data:{"userId":userId, "movieId":movieId,
						"content":content, "point":point}
					, success:function(data) {
						if (data.code == 200) {
							alert("메모가 수정되었습니다.");
							location.reload();
						} else {
							alert(data.error_message);
						}
					}
					, error:function(e) {
						alert("글을 저장하는데 실패했습니다.");
					}
				});
			});
			// 글 삭제
			$("#deleteBtn").on("click", function(){
				let postId = $(this).data("post-id");
				
				$.ajax({
					type:"delete"
					, url:"/post/delete"
					, data:{"postId":postId}
					, success:function(data) {
						if (data.result == "성공") {
							location.href = "/post/post-list-view";
						} else {
							alert(data.error_message);
						}
					}
					, error:function(e) {
						alert("글을 삭제하는데 실패했습니다.");
					}
				});
			});
		});
	</script>
</th:block>